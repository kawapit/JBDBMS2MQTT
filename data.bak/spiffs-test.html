<html lang="en" xml:lang="en" data-bs-theme="%theme%">
<head>
 <meta http-equiv="content-type" content="text/html;charset=UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1">
 <link rel="shortcut icon"
 href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAHsSURBVDhPrZLLSxtRFMZHY9A2Wou0FB+oiZUWTaPEVo15qInBjamSqLFVk0rV0ke0saAmgg90o5v42NQHCmYkXehC/wbFuK//gG6yyiIki0Dg69zDEEgp46L+4HKHc8/3zTnnXg7/yf0b7O7tIZVK0XcikaBdCjKIx+MI8jzGxj+hWadHu9mC94NDlHAXZBAIrENTVw+O49LrlaYOfv8cJUnBnV9cYNjlJlGOPBfZMnnaZGrqBw6DQTH131AFLtcHEjDxQ0UBunvsMBhMWFhcoiQpyODj6Fj6rz6fH03NOmpL2/BGmEkLnZdXVGJ+YRFPnj5DKPSLxAzu5uYWkUgEXba3KHxchP39AyhVVVheXoFarYHZ0oHPX76iplYNj2cCptY29DsHRLlYQTKZxOnpGaLRKFRV1dAbjLAJhsUlZdBqX8PpfIeS0jKhCiW+e73gsmQkZpABIxaL4ff1NbXxzeNBVnYOFPmPUP3iJazWTuQ9UNCQJyYnKef4+IR0aQMGzx/Bbu/Fz+0dDA4Nw+0ewfTMLFZX1+imWIw9NEdvPzY2t0iTYeAT7r1Fb4TBaBIeUwfNRal6TiU7HH0UY2dt7WY0NulIk2HwN2y4FosV8tw8XIbDYjQTSYPw1RUC6xvU0mGQF6OZSBrcDfAHIwsaPAvZdQgAAAAASUVORK5CYII=">
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
 <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" rel="stylesheet">

 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
 <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js "></script>
 <title>%deviceName%</title>
</head>

<body>
 <noscript><strong>We're sorry but it doesn't work properly without JavaScript enabled. Please enable it to continue.</strong></noscript>
 <div class="container-sm col-sm-10 col-md-6 col-lg-4">

%header%
<figure class="text-center"><h2>SPIFFS File Manager</h2></figure>

<div class="gx-0 bg-info bg-opacity-50 p-1 my-2">
 <figure class="text-center"><h6>Build Time Stamp: %timestamp%</h6></figure>
 <p><figure class="text-center"><h6>SPIFFS Storage: <span id="totalspiffs">%total%</span> | used: <span id="usedspiffs">%used%</span></h6></figure></p>
</div>

<div class="d-grid gap-1">
 <a class="btn btn-primary" onclick="Directory()" role="button">Directory</a>
 <a class="btn btn-primary" onclick="Upload()" role="button">upload</a>
 <a class="btn btn-primary" onclick="Reboot()" role="button">reboot</a>
 <a class="btn btn-primary" onclick="Logout()" role="button">logout</a>
 <a class="btn btn-primary" href="/settings" role="button">back</a>
</div>

 <p id="statusID"></p>
 <p id="directoryHeaderID"></p>
 <p id="directoryDetailsID"></p>
 <p id="uploadHeaderID"></p>
 <p id="uploadID"></p>

<script>
function Logout() {
 var xhr = new XMLHttpRequest(); xhr.open("GET","/logout",true); xhr.send();
 setTimeout(function() { window.open("/logged-out","_self"); },1000);
}
function Reboot() {
 document.getElementById("statusID").innerHTML="invoking Reboot...";
 var xhr = new XMLHttpRequest(); xhr.open("GET","/reboot",true); xhr.send();
 setTimeout(function() { window.open("/reboot","_self"); },500);
}
function Directory() {
 xmlhttp=new XMLHttpRequest(); xmlhttp.open("GET","/directory",false); xmlhttp.send();
 document.getElementById("directoryHeaderID").innerHTML="<h4>Files<h4>";
 document.getElementById("directoryDetailsID").innerHTML=xmlhttp.responseText;
}
function DirectoryButtonHandler(filename,action) {
 var urltocall = "/file?name="+"/"+filename+"&action="+action;
 xmlhttp=new XMLHttpRequest();
 if (action=="delete") {
 xmlhttp.open("GET",urltocall,false); xmlhttp.send();
 document.getElementById("statusID").innerHTML=xmlhttp.responseText;
 xmlhttp.open("GET","/directory",false); xmlhttp.send();
 document.getElementById("directoryDetailsID").innerHTML=xmlhttp.responseText;
 }
 if (action=="download") {
 document.getElementById("statusID").innerHTML="";
 window.open(urltocall,"_blank");
 }
}
function Upload() {
 document.getElementById("uploadHeaderID").innerHTML="<h4>upload File<h4>"
 document.getElementById("statusID").innerHTML="";
 var uploadform=
 "<form id=\"uploadformID\" enctype=\"multipart/form-data\" method=\"post\">" +
 "<input type=\"file\" name=\"file1\" id=\"file1\" onchange=\"UploadFile()\"><br>" +
 "<progress id=\"progressBarID\" value=\"0\" max=\"100\" style=\"width:300px;\"></progress>" +
 "<h4 id=\"statusID\"></h4>" +
 "<p id=\"loaded_n_total\"></p>" +
 "</form>";
 document.getElementById("uploadID").innerHTML=uploadform;
}
function _(el) {
 return document.getElementById(el);
}

function UploadFile() {
 var file=_("file1").files[0];
 // alert(file.name+" | "+file.size+" | "+file.type);
 var formdata=new FormData();
 formdata.append("file1",file);
 var ajax=new XMLHttpRequest();
 ajax.upload.addEventListener("progress",ProgressHandler,false);
 ajax.addEventListener("load",CompleteHandler,false); // doesnt appear to ever get called even upon success
 ajax.addEventListener("error",ErrorHandler,false);
 ajax.addEventListener("abort",AbortHandler,false);
 ajax.open("POST","/");
 ajax.send(formdata);
}

function ProgressHandler(event) {_("loaded_n_total").innerHTML="Uploaded "+event.loaded+" bytes";
 var percent=(event.loaded/event.total)*100;
 _("progressBarID").value=Math.round(percent);
 _("statusID").innerHTML=Math.round(percent)+"% uploaded... please wait";
 if (percent>=100) {
 _("statusID").innerHTML="done";
 document.getElementById("directoryHeaderID").innerHTML="";
 document.getElementById("directoryDetailsID").innerHTML="";
 document.getElementById("uploadHeaderID").innerHTML="";
 document.getElementById("uploadID").innerHTML="";
 }
}

function CompleteHandler(event) {_("statusID").innerHTML="Upload complete"; _("progressBarID").value=0;
 xmlhttp=new XMLHttpRequest(); xmlhttp.open("GET","/directory",false); xmlhttp.send();
 document.getElementById("statusID").innerHTML="File uploaded";
 document.getElementById("directoryHeaderID").innerHTML="<h4>Files<h4>";
 document.getElementById("directoryDetailsID").innerHTML=xmlhttp.responseText;
 document.getElementById("uploadHeaderID").innerHTML="";
 document.getElementById("uploadID").innerHTML="";
}
function ErrorHandler(event) {_("statusID").innerHTML="Upload failed";}
function AbortHandler(event) {_("statusID").innerHTML="aborted";}
</script>
</body>
</html>
